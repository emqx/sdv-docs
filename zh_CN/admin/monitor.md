# 资源阈值监控

sdv-flow 具备强大的资源监控功能，能够实时检测车端的CPU和内存资源占用情况，当资源占用超过设定阈值并持续一定时间后，将自动执行相应操作以保障系统稳定运行。以下是详细的配置参数说明，帮助您根据实际需求合理设置监控策略。

## 基本配置

- **enable**：此参数用于控制是否开启自动监控资源占用功能。建议始终将其设置为`true`，以确保资源监控功能正常运行。默认情况下，该参数值为`true`。

- **cpu**：设定CPU资源占用的阈值，以百分比形式表示。当CPU占用率超过该阈值时，系统将开始计时。如果在设定的持续时间（duration）内CPU占用率一直超过该阈值，将触发后续操作。默认阈值为80%。

- **memory**：设定内存资源占用的阈值，单位为MB。当内存占用量超过该阈值时，系统同样会开始计时。若在设定的持续时间（duration）内内存占用量持续超过该阈值，将执行后续操作。默认阈值为200MB。

- **action**：当CPU或内存资源占用超过设定阈值并持续一定时间后，系统将根据此参数决定执行的操作。目前支持的操作有`restart`和`no`。若设置为`restart`，系统将自动重启相关服务或进程；若设置为`no`，则不会执行任何操作，仅会打印相关日志信息。默认操作为`restart`。

- **duration**：单位为秒（s），表示CPU持续超过阈值或内存持续超过阈值的最短时间。只有当资源占用超过阈值的情况持续该时间后，才会触发`action`中设定的操作。默认持续时间为10秒。

## 配置示例

以下是云端下发配置的示例，展示了如何根据实际需求设置监控参数：

**POST /api/edgeservices/config**

```
{
    "ids": ["vin"],
    "method": "POST",
    "path": "/configs/threshold",
    "category":2,
    "body": "{\"enable\": true,\"cpu\": \"85%\",\"memory\": \"250\",\"action\": \"restart\",\"duration\":15}"
}
```

在该示例中，资源监控功能被开启。当CPU占用率超过85%或内存占用量超过250MB，并且这种情况持续15秒时，系统将自动执行重启操作。

## 注意事项

- 在设置阈值时，请充分考虑车端硬件性能和实际运行的应用程序需求，避免设置过低的阈值导致频繁误触发重启操作。
- 定期检查和调整监控参数，以适应系统运行状态的变化和业务需求的更新。

通过合理配置SDV-Flow的资源监控功能，能够有效预防因资源占用过高导致的系统卡顿、崩溃等问题，确保车端系统的稳定运行，为您的业务提供有力保障。

