# 消费者协议与 SDK 文档

## 简介

本文档旨在为用户提供使用 消息总线模块中的 MQTT 消息队列 消费者协议及 SDK 的使用指南。
本章介绍的方式通常使用在测试场景中，在生产环境请结合流处理引擎进行数据的消费和回溯，参考 [Nano Sink](/zh_CN/stream-processing/sinks/nano.md)

## 消费者协议概述

MQTT 消息队列 消费者协议允许用户通过请求/响应（req/rep）接口来查询 Ringbus 中的数据，或者已经存储到文件中的数据。以下是关于 MQTT 消息队列 消费者协议的重要信息：

- **请求/响应接口：** 用户可以通过发送请求来获取存储在 Ringbus 中的数据，或者从已存储文件中检索数据。请求可以是获取所有文件存放的 MQTT 消息，或者根据特定的键（key）获取单个或批量 MQTT 消息。
  
- **存储格式：** MQTT 消息在 Ringbus 的文件中以键值对的形式进行存储。key为时间戳。

## SDK 概述

MQTT 消息队列 提供了一个基于 C 语言的 SDK，用户可以使用该 SDK 编写应用程序来查询 Ringbus 中的数据。SDK 中包含了一个名为 `exchange_consumer` 的演示程序，用户可以自行编译并使用该程序进行查询。以下是关于 SDK 的重要信息：

- **exchange_consumer 演示程序：** 该程序允许用户执行各种查询操作，包括获取所有文件存放的 MQTT 消息，根据特定的键获取单个消息，或根据一批键获取批量消息。

## 使用示例

以下是使用 MQTT 消息队列 消费者协议及 SDK 的示例：

1. 获取所有文件所存放的 MQTT 消息：

    ```shell
    $ ./demo/exchange_consumer/exchange_consumer "dumpfile"
    "{\"file\":[\"61616161616161616161\",\"61616161616161616161\",\"61616161616161616161\",...\"61616161616161616161\"]}"
    ```

2. 通过特定的键从文件中获取 MQTT 消息：

    ```shell
    $ ./demo/exchange_consumer/exchange_consumer "dumpkey:5023450830686577130"
    "{\"file\":[\"61616161616161616161\"]}"
    ```

3. 通过特定的一批键从文件中获取批量 MQTT 消息：

    ```shell
    $ ./demo/exchange_consumer/exchange_consumer "dumpkeys:2062146488009373518,2625100014974548622"
    "{\"file\":[\"61616161616161616161\",\"61616161616161616161\"]}"
    ```

## 总结

本文档介绍了 MQTT 消息队列 消费者协议及 SDK 的使用方法。用户可以通过该协议和 SDK 轻松查询 Ringbus 中的数据，以及已存储到文件中的 MQTT 消息。